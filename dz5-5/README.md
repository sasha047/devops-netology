# Домашнее задание к занятию 5. «Оркестрация кластером Docker контейнеров на примере Docker Swarm»---## Задача 1Дайте письменые ответы на вопросы:- В чём отличие режимов работы сервисов в Docker Swarm-кластере: replication и global?- Какой алгоритм выбора лидера используется в Docker Swarm-кластере?- Что такое Overlay Network?Ответы:  1. В режиме replicated приложение запускается в том количестве экземпляров, какое укажет пользователь.   На отдельной ноде может быть как несколько экземпляров приложения, так и не быть совсем.  В режиме global приложение запускается на каждой ноде и в единственном экземпляре.  2. Использует алгоритм консенсуса Raft.- Все manager ноды имеют одинаковое представление о состоянии кластера;- Минимум  3-х manager нод необходимо для отказоустойчивости;- Количество нод обязательно нечётное, но не более 7 (рекомендация из документации).- Среди manager нод выбирается лидер, его задача гарантировать согласованность.- Лидер отправляет keepalive пакеты с заданной периодичностью в пределах 150-300мс. Если пакеты не пришли, менеджеры начинают выборы нового лидера.- Если кластер разбит, нечётное количество нод должно гарантировать, что кластер останется консистентным, т.к. факт изменения состояния считается совершенным, если его отразило большинство нод. Если разбить кластер пополам, нечётное число гарантирует что в какой-то части кластера будет большинство нод. 3. Overlay network  — виртуальная сеть туннелей, работающая поверх физической.   Underlay — физическая сеть со стабильной конфигурацией.   Overlay — абстракция над Underlay для изоляции.  Overlay может быть таким:  - GRE-туннель- VXLAN- EVPN- L3VPN- GENEVE и т.д.L2 VPN сеть для связи демонов Docker между собой. В основе используется технология vxlan.  ## Задача 2Создайте ваш первый Docker Swarm-кластер в Яндекс Облаке.Чтобы получить зачёт, предоставьте скриншот из терминала (консоли) с выводом команды:```docker node ls```- Отредактировал файл centos-7-base.json, вынес в переменные (отдельным файлом (секреты)).  - Создал образ командой: packer build -var-file=src/packer/vars/variables.json  src/packer/centos-7-base.json (указал путь до файла с переменными)- Добавил значения переменных в файлы в папке Terraform- Создал key.json по инструкции: https://cloud.yandex.ru/docs/cli/operations/authentication/service-account- terraform plan- terraform apple- Проверяем ВМ, заходим на каждую и вводим "yes". чтобы не было лишних ворнингов или ошибок при запуске плейбуков- Запустил плейбук по созданию кластера: swarm-deploy-cluster.yml и  дожидаемся установки и проверяем работоспосбность![Рис. 2-1](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/2-1.png)![Рис. 2-2](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/2-2.png)![Рис. 2-3](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/2-3.png)![Рис. 2-4](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/2-4.png)![Рис. 2-5](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/2-5.png)![Рис. 2-6](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/2-6.png)## Задача 3Создайте ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.Чтобы получить зачёт, предоставьте скриншот из терминала (консоли), с выводом команды:```docker service ls```Решение:  Устанавливаем систему мониторинга на кластер  ![Рис. 3-1](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/3-1.png)![Рис. 3-2](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/3-2.png)![Рис. 3-3](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/3-3.png)![Рис. 3-4](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/3-4.png)![Рис. 3-5](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/3-5.png)![Рис. 3-6](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/3-6.png)## Задача 4 (*)Выполните на лидере Docker Swarm-кластера команду, указанную ниже, и дайте письменное описание её функционала — что она делает и зачем нужна:```# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/docker swarm update --autolock=true```Ответ:  ![Рис. 4](https://github.com/sasha047/devops-netology/blob/main/dz5-5/img/4.png)- --autolock=true- init --autolock при создании кластера При ребуте manager ноды необходимо будет ввести  ключ разблокировки на manager ноде для присоедининения к кластеру,  Ввод ключа позволит расшифровать лог Raft и загрузить все "секреты" в память ноды   (логины, пароли, TLS ключи, SSH ключи и т.п.)  Это нужно для защиты кластера от несанкционированного доступа к файлам ноды.   